<!DOCTYPE html>
<html>
<head>
    <title>Admin API Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a1a; color: #fff; }
        .test { margin: 20px 0; padding: 15px; background: #2a2a2a; border-radius: 8px; }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #fbbf24; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #3b82f6; color: white; border: none; border-radius: 5px; }
        button:hover { background: #2563eb; }
        pre { background: #000; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ Admin API Test</h1>
    
    <div class="test">
        <h3>Step 1: Check if you're logged in</h3>
        <button onclick="checkAuth()">Check Auth Status</button>
        <pre id="auth-result"></pre>
    </div>
    
    <div class="test">
        <h3>Step 2: Test Admin Stats</h3>
        <button onclick="testAdminStats()">Get Admin Stats</button>
        <pre id="stats-result"></pre>
    </div>
    
    <div class="test">
        <h3>Step 3: Test Get Users</h3>
        <button onclick="testGetUsers()">Get Users</button>
        <pre id="users-result"></pre>
    </div>
    
    <div class="test">
        <h3>Step 4: Test AI Reports</h3>
        <button onclick="testAIReports()">Get AI Reports</button>
        <pre id="ai-result"></pre>
    </div>

    <script>
        const API_BASE = 'http://localhost:5001/api';
        
        function getToken() {
            return localStorage.getItem('token');
        }
        
        function getAuthUser() {
            const user = localStorage.getItem('authUser');
            return user ? JSON.parse(user) : null;
        }
        
        async function checkAuth() {
            const result = document.getElementById('auth-result');
            const token = getToken();
            const user = getAuthUser();
            
            if (!token) {
                result.innerHTML = '<span class="error">‚ùå No token found. Please login first.</span>';
                return;
            }
            
            if (!user) {
                result.innerHTML = '<span class="error">‚ùå No user data found. Please login first.</span>';
                return;
            }
            
            result.innerHTML = `<span class="success">‚úÖ Logged in as: ${user.email}</span>\n`;
            result.innerHTML += `User ID: ${user.id}\n`;
            result.innerHTML += `Is Admin: ${user.email === 'ronaldo@gmail.com' ? 'YES ‚úÖ' : 'NO ‚ùå'}\n`;
            result.innerHTML += `Token: ${token.substring(0, 20)}...`;
        }
        
        async function testAdminStats() {
            const result = document.getElementById('stats-result');
            const token = getToken();
            
            if (!token) {
                result.innerHTML = '<span class="error">‚ùå Please login first</span>';
                return;
            }
            
            result.innerHTML = '<span class="warning">‚è≥ Loading...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/admin/stats`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">‚úÖ Success!</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    result.innerHTML = `<span class="error">‚ùå Error ${response.status}</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (err) {
                result.innerHTML = `<span class="error">‚ùå Request failed: ${err.message}</span>`;
            }
        }
        
        async function testGetUsers() {
            const result = document.getElementById('users-result');
            const token = getToken();
            
            if (!token) {
                result.innerHTML = '<span class="error">‚ùå Please login first</span>';
                return;
            }
            
            result.innerHTML = '<span class="warning">‚è≥ Loading...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/admin/users`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">‚úÖ Success! Found ${data.length} users</span>\n${JSON.stringify(data.slice(0, 2), null, 2)}...`;
                } else {
                    result.innerHTML = `<span class="error">‚ùå Error ${response.status}</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (err) {
                result.innerHTML = `<span class="error">‚ùå Request failed: ${err.message}</span>`;
            }
        }
        
        async function testAIReports() {
            const result = document.getElementById('ai-result');
            const token = getToken();
            
            if (!token) {
                result.innerHTML = '<span class="error">‚ùå Please login first</span>';
                return;
            }
            
            result.innerHTML = '<span class="warning">‚è≥ Loading...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/admin/reports/ai`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">‚úÖ Success!</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    result.innerHTML = `<span class="error">‚ùå Error ${response.status}</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (err) {
                result.innerHTML = `<span class="error">‚ùå Request failed: ${err.message}</span>`;
            }
        }
        
        // Auto-check auth on load
        window.onload = checkAuth;
    </script>
</body>
</html>
