import{c as W,r as c,G as R,n as Z,u as ss,b as f,_ as j,j as s,x as B,z as F,e as b,i as M,L as k,B as es,g as U,T as ts}from"./index-BZ0hST_k.js";import{U as Y}from"./user-check-BHj-mZXU.js";import{U as as}from"./user-plus-D_28Q8fX.js";import{C as V,a as $}from"./circle-x-kkvPsnd5.js";/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=W("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),is=()=>{const{notifications:i,addNotification:x,clearNotification:N}=R(),[l,v]=c.useState([]),[w,u]=c.useState(!0);c.useEffect(()=>{(async()=>{try{const o=(await f.get("/users/notifications")).data||[];console.log(`üì• Loaded ${o.length} notifications from DB`),o.forEach(r=>{x({type:r.isBroadcast?"admin_broadcast":"admin",title:r.title,message:r.message,color:r.color,notificationType:r.type,createdAt:r.createdAt,id:r._id,dbId:r._id,_id:r._id})})}catch(n){console.error("Error loading notifications:",n)}finally{u(!1)}})()},[]),c.useEffect(()=>{const a=i.filter(n=>n.type==="admin"||n.type==="admin_broadcast");v(a)},[i]);const y=a=>({green:"border-success",red:"border-error",blue:"border-info",yellow:"border-warning",orange:"border-orange-500"})[a]||"border-info",h=a=>({green:"text-success",red:"text-error",blue:"text-info",yellow:"text-warning",orange:"text-orange-500"})[a]||"text-info",S=a=>{switch(a){case"success":return s.jsx(V,{className:"w-5 h-5"});case"error":return s.jsx($,{className:"w-5 h-5"});case"warning":return s.jsx(C,{className:"w-5 h-5"});case"info":default:return s.jsx(U,{className:"w-5 h-5"})}},g=async a=>{var n,o,r;try{console.log("Deleting notification:",a),a.dbId&&(console.log(`Calling DELETE /users/notifications/${a.dbId}`),await f.delete(`/users/notifications/${a.dbId}`),console.log("Backend deletion successful")),N(a.id),j.success("Notification deleted")}catch(m){console.error("Error deleting notification:",m),console.error("Error response:",(n=m.response)==null?void 0:n.data),j.error(((r=(o=m.response)==null?void 0:o.data)==null?void 0:r.error)||"Failed to delete notification")}};return w?s.jsx("div",{className:"flex justify-center py-4",children:s.jsx(k,{className:"w-6 h-6 animate-spin text-primary"})}):l.length===0?null:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(U,{className:"w-5 h-5 text-primary"}),s.jsx("h3",{className:"font-semibold text-base",children:"Admin Messages"})]}),l.map(a=>s.jsx("div",{className:`bg-base-100 border-2 ${y(a.color)} rounded-lg p-3 sm:p-4 shadow-sm hover:shadow-md transition-all`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:`flex-shrink-0 ${h(a.color)}`,children:S(a.notificationType)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:`font-bold text-sm sm:text-base ${h(a.color)} mb-1`,children:a.title}),s.jsx("p",{className:"text-xs sm:text-sm text-base-content/80",children:a.message}),a.createdAt&&s.jsx("p",{className:"text-xs text-base-content/50 mt-2",children:new Date(a.createdAt).toLocaleString()})]}),s.jsx("button",{onClick:()=>g(a),className:"btn btn-ghost btn-circle btn-xs flex-shrink-0 hover:bg-error/10 hover:text-error",title:"Delete notification",children:s.jsx(ts,{className:"w-4 h-4"})})]})},a.id))]})},os=()=>{var _,A,E;const[i,x]=c.useState("discover"),{clearBadge:N}=R(),[l,v]=c.useState(""),[w,u]=c.useState([]),[y,h]=c.useState(!1),[S,g]=c.useState([]),[a,n]=c.useState(!0),[o,r]=c.useState(null),{pendingReceived:m,acceptRequest:P,rejectRequest:z,fetchFriendData:I}=Z(),{authUser:t}=ss(),{notifications:H}=R(),J=H.filter(e=>e.type==="admin"||e.type==="admin_broadcast"),O=((_=t==null?void 0:t.verificationRequest)==null?void 0:_.status)&&t.verificationRequest.status!=="none",q=J.length+(O?1:0)+(t!=null&&t.isSuspended?1:0);c.useEffect(()=>{I()},[I]),c.useEffect(()=>{i==="discover"&&Q()},[i]);const Q=async()=>{const e=sessionStorage.getItem("suggestedUsers"),p=sessionStorage.getItem("suggestedUsersTime"),d=Date.now();if(e){if(g(JSON.parse(e)),n(!1),p&&d-parseInt(p)<12e4)return}else n(!0);try{const T=(await f.get("/users/suggested")).data||[];g(T),sessionStorage.setItem("suggestedUsers",JSON.stringify(T)),sessionStorage.setItem("suggestedUsersTime",d.toString())}catch(D){console.error("Error fetching suggested users:",D),e||j.error("Failed to load suggested users")}finally{n(!1)}};c.useEffect(()=>{if(i!=="discover")return;if(!l.trim()){u([]);return}h(!0);const e=setTimeout(()=>{(async()=>{try{const d=await f.get(`/users/search?q=${l}`);u(d.data)}catch(d){console.error("Search error:",d),j.error("Failed to search users")}finally{h(!1)}})()},300);return()=>clearTimeout(e)},[l,i]);const X=async e=>{r(e),await P(e),r(null)},G=async e=>{r(e),await z(e),r(null)},L=l.trim()?w:S,K=l.trim()?y:a;return s.jsx("div",{className:"min-h-screen pt-14 xs:pt-16 sm:pt-18 md:pt-20 pb-16 xs:pb-18 sm:pb-20 md:pb-10 px-2 xs:px-3 sm:px-4 bg-base-200",children:s.jsxs("div",{className:"max-w-4xl mx-auto",children:[s.jsxs("div",{className:"bg-base-100 rounded-lg sm:rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2 sm:mb-4",children:[s.jsx(B,{className:"w-6 h-6 sm:w-8 sm:h-8 text-primary flex-shrink-0"}),s.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold",children:"Social Hub"})]}),s.jsx("p",{className:"text-sm sm:text-base text-base-content/70",children:"Discover users, manage requests, and stay updated"})]}),s.jsx("div",{className:"bg-base-100 rounded-lg sm:rounded-xl shadow-lg mb-4 sm:mb-6 overflow-hidden",children:s.jsxs("div",{className:"flex border-b border-base-300 relative",children:[s.jsx("div",{className:"absolute bottom-0 h-0.5 bg-primary transition-all duration-300 ease-out",style:{width:"33.333%",transform:`translateX(${i==="discover"?"0%":i==="requests"?"100%":"200%"})`}}),s.jsxs("button",{onClick:()=>x("discover"),className:`flex-1 flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-3 sm:py-4 font-semibold transition-all duration-300 text-xs sm:text-base relative ${i==="discover"?"text-primary scale-105":"text-base-content/60 hover:text-base-content hover:bg-base-200/50"}`,children:[s.jsx(F,{className:`w-4 h-4 sm:w-5 sm:h-5 transition-transform duration-300 ${i==="discover"?"scale-110":""}`}),s.jsx("span",{children:"Discover"})]}),s.jsxs("button",{onClick:()=>x("requests"),className:`flex-1 flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-3 sm:py-4 font-semibold transition-all duration-300 relative text-xs sm:text-base ${i==="requests"?"text-primary scale-105":"text-base-content/60 hover:text-base-content hover:bg-base-200/50"}`,children:[s.jsx(Y,{className:`w-4 h-4 sm:w-5 sm:h-5 transition-transform duration-300 ${i==="requests"?"scale-110":""}`}),s.jsx("span",{children:"Requests"}),m.length>0&&s.jsx("span",{className:"absolute top-1 right-1 sm:relative sm:top-0 sm:right-0 badge badge-error badge-xs sm:badge-sm animate-pulse",children:m.length})]}),s.jsxs("button",{onClick:()=>{x("notifications"),N()},className:`flex-1 flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-2 sm:px-4 py-3 sm:py-4 font-semibold transition-all duration-300 relative text-xs sm:text-base ${i==="notifications"?"text-primary scale-105":"text-base-content/60 hover:text-base-content hover:bg-base-200/50"}`,children:[s.jsx(C,{className:`w-4 h-4 sm:w-5 sm:h-5 transition-transform duration-300 ${i==="notifications"?"scale-110":""}`}),s.jsx("span",{children:"Notifications"}),q>0&&s.jsx("span",{className:"absolute top-1 right-1 sm:relative sm:top-0 sm:right-0 badge badge-error badge-xs sm:badge-sm animate-pulse",children:q>9?"9+":q})]})]})}),i==="discover"&&s.jsxs("div",{className:"animate-fade-in",children:[s.jsx("div",{className:"bg-base-100 rounded-lg sm:rounded-xl shadow-lg p-3 sm:p-6 mb-4 sm:mb-6",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 sm:pl-4 flex items-center pointer-events-none",children:s.jsx(F,{className:"h-4 w-4 sm:h-5 sm:w-5 text-base-content/60"})}),s.jsx("input",{type:"text",placeholder:"Search username...",className:"input input-bordered w-full pl-10 sm:pl-12 pr-3 sm:pr-4 text-sm sm:text-base h-10 sm:h-12",value:l,onChange:e=>v(e.target.value)})]})}),s.jsxs("div",{className:"bg-base-100 rounded-lg sm:rounded-xl shadow-lg p-3 sm:p-6",children:[s.jsx("h2",{className:"text-base sm:text-xl font-semibold mb-3 sm:mb-4",children:l.trim()?"Search Results":"Suggested Users"}),K?s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[...Array(4)].map((e,p)=>s.jsx("div",{className:"card bg-base-200 border border-base-300 animate-pulse",children:s.jsx("div",{className:"card-body p-3 sm:p-4",children:s.jsxs("div",{className:"flex items-start gap-3 sm:gap-4",children:[s.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full bg-base-300"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("div",{className:"h-4 bg-base-300 rounded w-3/4"}),s.jsx("div",{className:"h-3 bg-base-300 rounded w-1/2"}),s.jsx("div",{className:"h-8 bg-base-300 rounded w-full mt-2"})]})]})})},p))}):L.length===0?s.jsxs("div",{className:"text-center py-8 sm:py-12",children:[s.jsx(B,{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 text-base-content/30"}),s.jsx("p",{className:"text-sm sm:text-base text-base-content/60 px-4",children:l.trim()?`No users found for "${l}"`:"No suggested users available"})]}):s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:L.map(e=>s.jsx("div",{className:"card bg-base-200 hover:bg-base-300 transition-all duration-200 border border-base-300",children:s.jsx("div",{className:"card-body p-3 sm:p-4",children:s.jsxs("div",{className:"flex items-start gap-3 sm:gap-4",children:[s.jsx(b,{to:`/profile/${e.username}`,className:"flex-shrink-0",children:s.jsx("div",{className:"avatar",children:s.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full ring-2 ring-primary ring-offset-base-100 ring-offset-1 sm:ring-offset-2",children:s.jsx("img",{src:e.profilePic||"/default-avatar.png",alt:e.username})})})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs(b,{to:`/profile/${e.username}`,children:[s.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[s.jsx("h3",{className:"font-semibold text-sm sm:text-lg truncate",children:e.nickname||e.username}),e.isVerified&&s.jsx(M,{size:"xs"})]}),s.jsxs("p",{className:"text-xs sm:text-sm text-base-content/70 mb-2",children:["@",e.username]})]}),e.bio&&s.jsx("p",{className:"text-xs sm:text-sm text-base-content/80 line-clamp-2 mb-2 sm:mb-3",children:e.bio}),s.jsx("div",{className:"flex gap-2",children:s.jsxs(b,{to:`/profile/${e.username}`,className:"btn btn-primary btn-xs sm:btn-sm flex-1 hover:scale-105 active:scale-95 transition-transform duration-200",children:[s.jsx(as,{className:"w-3 h-3 sm:w-4 sm:h-4"}),s.jsx("span",{className:"text-xs sm:text-sm",children:"View Profile"})]})})]})]})})},e._id))})]})]}),i==="requests"&&s.jsx("div",{className:"animate-fade-in",children:s.jsxs("div",{className:"bg-base-100 rounded-lg sm:rounded-xl shadow-lg p-3 sm:p-6",children:[s.jsx("h2",{className:"text-base sm:text-xl font-semibold mb-3 sm:mb-4",children:"Friend Requests"}),m.length===0?s.jsxs("div",{className:"text-center py-8 sm:py-12",children:[s.jsx(Y,{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 text-base-content/30"}),s.jsx("p",{className:"text-sm sm:text-base text-base-content/60",children:"No pending friend requests"})]}):s.jsx("div",{className:"space-y-3 sm:space-y-4",children:m.map(e=>s.jsx("div",{className:"card bg-base-200 border border-base-300 hover:shadow-lg hover:scale-[1.02] transition-all duration-300",children:s.jsx("div",{className:"card-body p-3 sm:p-4",children:s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[s.jsx(b,{to:`/profile/${e.username}`,className:"flex-shrink-0",children:s.jsx("div",{className:"avatar",children:s.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full ring-2 ring-primary ring-offset-base-100 ring-offset-1 sm:ring-offset-2",children:s.jsx("img",{src:e.profilePic||"/default-avatar.png",alt:e.username})})})}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsxs(b,{to:`/profile/${e.username}`,children:[s.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[s.jsx("h3",{className:"font-semibold text-sm sm:text-lg truncate",children:e.nickname||e.username}),e.isVerified&&s.jsx(M,{size:"xs"})]}),s.jsxs("p",{className:"text-xs sm:text-sm text-base-content/70",children:["@",e.username]})]})}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsx("button",{onClick:()=>X(e._id),disabled:o===e._id,className:"btn btn-success btn-xs sm:btn-sm hover:scale-105 active:scale-95 transition-transform duration-200",children:o===e._id?s.jsx(k,{className:"w-3 h-3 sm:w-4 sm:h-4 animate-spin"}):s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"w-3 h-3 sm:w-4 sm:h-4"}),s.jsx("span",{className:"text-xs sm:text-sm",children:"Accept"})]})}),s.jsx("button",{onClick:()=>G(e._id),disabled:o===e._id,className:"btn btn-ghost btn-xs sm:btn-sm hover:scale-105 active:scale-95 transition-transform duration-200",children:o===e._id?s.jsx(k,{className:"w-3 h-3 sm:w-4 sm:h-4 animate-spin"}):s.jsxs(s.Fragment,{children:[s.jsx($,{className:"w-3 h-3 sm:w-4 sm:h-4"}),s.jsx("span",{className:"text-xs sm:text-sm",children:"Reject"})]})})]})]})})},e._id))})]})}),i==="notifications"&&s.jsx("div",{className:"animate-fade-in",children:s.jsxs("div",{className:"bg-base-100 rounded-lg sm:rounded-xl shadow-lg p-3 sm:p-6",children:[s.jsx("h2",{className:"text-base sm:text-xl font-semibold mb-3 sm:mb-4",children:"Notifications"}),s.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[((A=t==null?void 0:t.verificationRequest)==null?void 0:A.status)&&t.verificationRequest.status!=="none"&&s.jsxs("div",{className:`alert text-sm sm:text-base ${t.verificationRequest.status==="pending"?"alert-warning":t.verificationRequest.status==="approved"?"alert-success":"alert-error"}`,children:[s.jsx(es,{className:"w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-bold text-sm sm:text-base",children:"Verification Request"}),s.jsxs("p",{className:"text-xs sm:text-sm mt-1",children:["Status: ",s.jsx("span",{className:"font-semibold capitalize",children:t.verificationRequest.status})]}),t.verificationRequest.status==="pending"&&s.jsx("p",{className:"text-xs sm:text-sm mt-2 opacity-90",children:"‚è≥ Your verification request is being reviewed by our admin team."}),t.verificationRequest.status==="approved"&&s.jsx("p",{className:"text-xs sm:text-sm mt-2 opacity-90",children:"üéâ Congratulations! Your account has been verified. You now have a verified badge on your profile."}),t.verificationRequest.status==="rejected"&&s.jsxs("div",{className:"mt-2",children:[s.jsx("p",{className:"text-xs sm:text-sm font-semibold mb-1",children:"‚ùå Request Rejected"}),t.verificationRequest.adminNote?s.jsxs("div",{className:"bg-base-100/50 p-2 sm:p-3 rounded-lg mt-2",children:[s.jsx("p",{className:"text-xs font-semibold mb-1",children:"Admin's Response:"}),s.jsx("p",{className:"text-xs sm:text-sm",children:t.verificationRequest.adminNote})]}):s.jsx("p",{className:"text-xs sm:text-sm opacity-90",children:"Your request does not meet verification criteria."}),s.jsx("p",{className:"text-xs mt-2 opacity-75",children:"You can submit a new request after addressing the issues mentioned above."})]}),t.verificationRequest.requestedAt&&s.jsxs("p",{className:"text-xs mt-2 opacity-60",children:["Requested: ",new Date(t.verificationRequest.requestedAt).toLocaleDateString()]})]})]}),(t==null?void 0:t.isSuspended)&&s.jsxs("div",{className:"alert alert-error text-sm sm:text-base",children:[s.jsx($,{className:"w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-bold text-sm sm:text-base",children:"‚ö†Ô∏è Account Suspended"}),s.jsxs("p",{className:"text-xs sm:text-sm mt-1",children:["Suspended Until: ",s.jsx("span",{className:"font-semibold",children:new Date(t.suspendedUntil).toLocaleString()})]}),t.suspensionReason&&s.jsxs("div",{className:"bg-base-100/50 p-2 sm:p-3 rounded-lg mt-2",children:[s.jsx("p",{className:"text-xs font-semibold mb-1",children:"Admin's Reason:"}),s.jsx("p",{className:"text-xs sm:text-sm",children:t.suspensionReason})]}),s.jsx("p",{className:"text-xs mt-2 opacity-75",children:"You will be able to access your account again after the suspension period ends."})]})]}),s.jsx(is,{}),!((E=t==null?void 0:t.verificationRequest)!=null&&E.status)&&!(t!=null&&t.isSuspended)&&s.jsxs("div",{className:"text-center py-8 sm:py-12",children:[s.jsx(C,{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 text-base-content/30"}),s.jsx("p",{className:"text-sm sm:text-base text-base-content/60",children:"No notifications at the moment"}),s.jsx("p",{className:"text-xs sm:text-sm text-base-content/50 mt-2 px-4",children:"You'll see important updates and messages here"})]})]})]})})]})})};export{os as default};
