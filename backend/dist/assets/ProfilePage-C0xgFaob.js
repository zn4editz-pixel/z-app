import{c as G,r as n,j as e,B as v,X as C,L as q,_ as i,b as w,u as ne,i as re,C as ie,U as ce,k as oe,l as _,g as me}from"./index-BZ0hST_k.js";import{C as E}from"./check-Uol-saN6.js";import{C as de}from"./clock-CcEyUotB.js";/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=G("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=G("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ue=({isOpen:s,onClose:d,onSuccess:u})=>{const[b,T]=n.useState(""),[j,N]=n.useState(null),[h,p]=n.useState(null),[l,y]=n.useState(!1),k=c=>{const m=c.target.files[0];if(!m)return;if(!m.type.startsWith("image/")){i.error("Please upload an image file");return}const t=new FileReader;t.onloadend=()=>{N(t.result),p(t.result)},t.readAsDataURL(m)},S=async c=>{var m,t;if(c.preventDefault(),!b.trim()){i.error("Please provide a reason");return}if(!j){i.error("Please upload ID proof");return}y(!0);try{await w.post("/users/request-verification",{reason:b.trim(),idProof:j}),i.success("Verification request submitted!"),u&&u(),d()}catch(P){console.error("Verification request error:",P),i.error(((t=(m=P.response)==null?void 0:m.data)==null?void 0:t.message)||"Failed to submit request")}finally{y(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-base-100 rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-base-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-6 h-6 text-primary"}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold",children:"Request Verification"})]}),e.jsx("button",{onClick:d,className:"btn btn-ghost btn-circle btn-sm",disabled:l,children:e.jsx(C,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:S,className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-primary"}),"Verification Badge"]}),e.jsx("p",{className:"text-sm text-base-content/70",children:"Get a blue checkmark next to your name to show you're verified. This helps others know you're authentic."})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Why do you want to be verified?"})}),e.jsx("textarea",{className:"textarea textarea-bordered h-24",placeholder:"I'm a content creator, public figure, business, etc...",value:b,onChange:c=>T(c.target.value),required:!0,disabled:l})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Upload ID Proof"})}),e.jsx("div",{className:"border-2 border-dashed border-base-300 rounded-lg p-4 text-center",children:h?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:h,alt:"ID Proof",className:"max-h-48 mx-auto rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{N(null),p(null)},className:"absolute top-2 right-2 btn btn-circle btn-sm btn-error",disabled:l,children:e.jsx(C,{className:"w-4 h-4"})})]}):e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-2 text-base-content/40"}),e.jsx("p",{className:"text-sm text-base-content/70 mb-2",children:"Click to upload ID proof"}),e.jsx("p",{className:"text-xs text-base-content/50",children:"Government ID, passport, or official document"}),e.jsx("input",{type:"file",accept:"image/*",onChange:k,className:"hidden",disabled:l})]})})]}),e.jsxs("div",{className:"text-xs text-base-content/60 bg-base-200 p-3 rounded-lg",children:[e.jsx("strong",{children:"Note:"})," Your information will be reviewed by our team. This process may take 1-3 business days."]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:d,className:"btn btn-ghost flex-1",disabled:l,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary flex-1 gap-2",disabled:l||!b.trim()||!j,children:l?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4"}),"Submit Request"]})})]})]})]})}):null},fe=()=>{var Y,$;const{authUser:s,isUpdatingProfile:d,updateProfile:u}=ne(),[b,T]=n.useState(null),[j,N]=n.useState(!1),[h,p]=n.useState(!1),[l,y]=n.useState((s==null?void 0:s.username)||""),[k,S]=n.useState(!1),[c,m]=n.useState(null),[t,P]=n.useState(null),[H,F]=n.useState(!1),[X,I]=n.useState(!1),[x,M]=n.useState((s==null?void 0:s.fullName)||""),[J,V]=n.useState(!1),[f,L]=n.useState((s==null?void 0:s.email)||""),[K,A]=n.useState(!1),[D,O]=n.useState(""),[B,z]=n.useState(!1);n.useEffect(()=>{W()},[]);const W=async()=>{try{const a=await w.get("/users/username-change-info");P(a.data)}catch(a){console.error("Error fetching username change info:",a)}};n.useEffect(()=>{if(!h||l===(s==null?void 0:s.username)){m(null);return}if(!l||l.length<3){m(null);return}const a=setTimeout(async()=>{S(!0);try{const r=await w.get(`/users/check-username/${l}`);m(r.data.available)}catch(r){console.error("Error checking username:",r)}finally{S(!1)}},500);return()=>clearTimeout(a)},[l,h,s==null?void 0:s.username]);const Q=async a=>{const r=a.target.files[0];if(!r)return;const o=new FileReader;o.readAsDataURL(r),o.onload=async()=>{const g=o.result;T(g),await u({profilePic:g})}},Z=async()=>{var a,r;if(!(!c||!(t!=null&&t.canChange)))try{await u({username:l}),i.success("Username updated successfully!"),p(!1),F(!1),W(),setTimeout(()=>window.location.reload(),1e3)}catch(o){i.error(((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to update username")}},U=async()=>{var a,r;if(!x||x.trim().length<2){i.error("Full name must be at least 2 characters");return}try{await u({fullName:x.trim()}),i.success("Full name updated successfully!"),I(!1),setTimeout(()=>window.location.reload(),1e3)}catch(o){i.error(((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to update full name")}},ee=async()=>{var a,r;try{await w.post("/auth/send-email-otp",{newEmail:f}),i.success("OTP sent to your new email!"),A(!0)}catch(o){i.error(((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to send OTP")}},se=async()=>{var a,r;z(!0);try{await w.post("/auth/verify-email-change",{newEmail:f,otp:D}),i.success("Email updated successfully!"),V(!1),A(!1),O(""),setTimeout(()=>window.location.reload(),1e3)}catch(o){i.error(((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.error)||"Invalid OTP")}finally{z(!1)}},ae=a=>{if(!a)return"";const r=new Date,g=new Date(a)-r;if(g<=0)return"Now";const te=Math.floor(g/(1e3*60*60*24)),le=Math.floor(g%(1e3*60*60*24)/(1e3*60*60));return`${te}d ${le}h`};return e.jsxs("div",{className:"min-h-screen bg-base-200",children:[e.jsx("div",{className:"max-w-2xl mx-auto px-2 xs:px-3 sm:px-4 pt-14 xs:pt-16 sm:pt-18 md:pt-20 pb-16 xs:pb-18 sm:pb-20 md:pb-10",children:e.jsxs("div",{className:"bg-base-100 rounded-lg sm:rounded-xl shadow-lg p-4 sm:p-6 space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-semibold flex items-center justify-center gap-2",children:["Profile",(s==null?void 0:s.isVerified)&&e.jsx(re,{size:"md"})]}),e.jsx("p",{className:"mt-1 sm:mt-2 text-sm sm:text-base text-base-content/70",children:"Your profile information"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:b||(s==null?void 0:s.profilePic)||"/avatar.png",alt:"Profile",className:"w-28 h-28 sm:w-32 sm:h-32 rounded-full object-cover border-4 border-base-300"}),e.jsxs("label",{htmlFor:"avatar-upload",className:`
                  absolute bottom-0 right-0 
                  bg-primary hover:scale-105
                  p-2 sm:p-2.5 rounded-full cursor-pointer 
                  transition-all duration-200 shadow-lg
                  ${d?"animate-pulse pointer-events-none":""}
                `,children:[e.jsx(ie,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary-content"}),e.jsx("input",{type:"file",id:"avatar-upload",className:"hidden",accept:"image/*",onChange:Q,disabled:d})]})]}),e.jsx("p",{className:"text-xs sm:text-sm text-base-content/60 text-center px-4",children:d?"Uploading...":"Click the camera icon to update your photo"})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-base-content/60 flex items-center gap-2",children:[e.jsx(ce,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Full Name"]}),X?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:x,onChange:a=>M(a.target.value),className:"input input-bordered w-full",placeholder:"Your full name"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:U,disabled:!x||x.trim().length<2||x===(s==null?void 0:s.fullName),className:"btn btn-success btn-sm",children:[e.jsx(E,{className:"w-4 h-4"}),"Save"]}),e.jsxs("button",{onClick:()=>{I(!1),M((s==null?void 0:s.fullName)||"")},className:"btn btn-ghost btn-sm",children:[e.jsx(C,{className:"w-4 h-4"}),"Cancel"]})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"flex-1 px-3 sm:px-4 py-2 sm:py-2.5 bg-base-200 rounded-lg border text-sm sm:text-base",children:s==null?void 0:s.fullName}),e.jsx("button",{onClick:()=>I(!0),className:"btn btn-sm btn-ghost",title:"Edit full name",children:e.jsx(R,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-base-content/60 flex items-center gap-2",children:[e.jsx(oe,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Username"]}),h?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:l,onChange:a=>y(a.target.value.toLowerCase().replace(/[^a-z0-9_.]/g,"")),className:"input input-bordered w-full pr-10",placeholder:"username"}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:k?e.jsx(q,{className:"w-5 h-5 animate-spin text-base-content/50"}):c===!0?e.jsx(E,{className:"w-5 h-5 text-success"}):c===!1?e.jsx(C,{className:"w-5 h-5 text-error"}):null})]}),l&&l!==(s==null?void 0:s.username)&&e.jsx("div",{className:"text-xs px-2",children:l.length<3?e.jsx("p",{className:"text-warning",children:"Username must be at least 3 characters"}):k?e.jsx("p",{className:"text-base-content/60",children:"Checking availability..."}):c===!0?e.jsx("p",{className:"text-success",children:"✓ Username is available"}):c===!1?e.jsx("p",{className:"text-error",children:"✗ Username is already taken"}):null})]}),t&&e.jsxs("div",{className:"alert alert-info text-xs sm:text-sm py-2",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsxs("p",{children:["Changes: ",t.changesThisWeek,"/2 this week"]}),!t.canChange&&t.nextChangeDate&&e.jsxs("p",{className:"flex items-center gap-1 mt-1",children:[e.jsx(de,{className:"w-3 h-3"}),"Next change in: ",ae(t.nextChangeDate)]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>F(!0),disabled:!l||l.length<3||!c||l===(s==null?void 0:s.username),className:"btn btn-success btn-sm",children:[e.jsx(E,{className:"w-4 h-4"}),"Save"]}),e.jsxs("button",{onClick:()=>{p(!1),y((s==null?void 0:s.username)||""),m(null)},className:"btn btn-ghost btn-sm",children:[e.jsx(C,{className:"w-4 h-4"}),"Cancel"]})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"flex-1 px-3 sm:px-4 py-2 sm:py-2.5 bg-base-200 rounded-lg border text-sm sm:text-base",children:["@",s==null?void 0:s.username]}),e.jsx("button",{onClick:()=>p(!0),disabled:!(t!=null&&t.canChange),className:"btn btn-sm btn-ghost",title:t!=null&&t.canChange?"Edit username":"Username change limit reached",children:e.jsx(R,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-base-content/60 flex items-center gap-2",children:[e.jsx(me,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Email Address"]}),J?K?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:D,onChange:a=>O(a.target.value.replace(/\D/g,"").slice(0,6)),className:"input input-bordered w-full text-center text-2xl tracking-widest",placeholder:"000000",maxLength:6}),e.jsxs("p",{className:"text-xs text-center text-base-content/60",children:["Enter the 6-digit code sent to ",f]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:se,disabled:D.length!==6||B,className:"btn btn-success btn-sm flex-1",children:B?e.jsx(q,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4"}),"Verify"]})}),e.jsx("button",{onClick:()=>{A(!1),O("")},className:"btn btn-ghost btn-sm",children:"Back"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"email",value:f,onChange:a=>L(a.target.value),className:"input input-bordered w-full",placeholder:"new@email.com"}),e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-base-200 rounded-lg border border-base-300",children:[e.jsx(_,{className:"w-3.5 h-3.5 text-info mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-base-content/70",children:"An OTP will be sent to verify your new email"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ee,disabled:!f||f===(s==null?void 0:s.email),className:"btn btn-primary btn-sm",children:"Send OTP"}),e.jsx("button",{onClick:()=>{V(!1),L((s==null?void 0:s.email)||"")},className:"btn btn-ghost btn-sm",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"flex-1 px-3 sm:px-4 py-2 sm:py-2.5 bg-base-200 rounded-lg border text-sm sm:text-base break-all",children:s==null?void 0:s.email}),e.jsx("button",{onClick:()=>V(!0),className:"btn btn-sm btn-ghost",title:"Edit email",children:e.jsx(R,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"bg-base-200 rounded-lg sm:rounded-xl p-4 sm:p-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-medium mb-3 sm:mb-4",children:"Account Information"}),e.jsxs("div",{className:"space-y-2 sm:space-y-3 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-base-300",children:[e.jsx("span",{className:"text-base-content/70",children:"Member Since"}),e.jsx("span",{className:"font-medium",children:(Y=s==null?void 0:s.createdAt)==null?void 0:Y.split("T")[0]})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-base-300",children:[e.jsx("span",{className:"text-base-content/70",children:"Account Status"}),e.jsx("span",{className:"badge badge-success badge-sm",children:"Active"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-base-content/70",children:"Verification"}),s!=null&&s.isVerified?e.jsxs("span",{className:"badge badge-primary badge-sm gap-1",children:[e.jsx(v,{className:"w-3 h-3"}),"Verified"]}):(($=s==null?void 0:s.verificationRequest)==null?void 0:$.status)==="pending"?e.jsx("span",{className:"badge badge-warning badge-sm",children:"Pending Review"}):e.jsxs("button",{onClick:()=>N(!0),className:"btn btn-primary btn-xs gap-1",children:[e.jsx(v,{className:"w-3 h-3"}),"Request Verification"]})]})]})]})]})}),H&&e.jsx("div",{className:"modal modal-open",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Confirm Username Change"}),e.jsxs("p",{className:"py-4",children:["Are you sure you want to change your username to ",e.jsxs("strong",{children:["@",l]}),"?",e.jsx("br",{}),e.jsx("br",{}),"You have ",2-((t==null?void 0:t.changesThisWeek)||0)," change(s) remaining this week."]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{onClick:Z,className:"btn btn-success",children:"Confirm"}),e.jsx("button",{onClick:()=>F(!1),className:"btn",children:"Cancel"})]})]})}),e.jsx(ue,{isOpen:j,onClose:()=>N(!1),onSuccess:()=>{window.location.reload()}})]})};export{fe as default};
