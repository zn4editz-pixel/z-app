import{c as E,r as i,a as M,j as e,U as R,g as y,f as $,e as q,A as D,b as h,_ as n}from"./index-BZ0hST_k.js";import{C as U}from"./clock-CcEyUotB.js";/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=E("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]),V=()=>{const[r,j]=i.useState(1),[m,g]=i.useState(""),[u,w]=i.useState(""),[x,v]=i.useState(""),[b,P]=i.useState(""),[T,N]=i.useState(""),[d,c]=i.useState(!1),[l,p]=i.useState(0),k=M();i.useEffect(()=>{if(l>0){const s=setTimeout(()=>p(l-1),1e3);return()=>clearTimeout(s)}},[l]);const O=async s=>{var t,a;s.preventDefault(),c(!0);try{const o=await h.post("/auth/forgot-password",{username:m});n.success(o.data.message),N(o.data.email),p(60),j(2)}catch(o){n.error(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to send OTP")}finally{c(!1)}},S=async s=>{var t,a;if(s.preventDefault(),l===0){n.error("OTP expired! Please request a new one.");return}c(!0);try{await h.post("/auth/verify-reset-otp",{username:m,otp:u}),n.success("OTP verified!"),j(3)}catch(o){n.error(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.message)||"Invalid OTP")}finally{c(!1)}},C=async s=>{var t,a;if(s.preventDefault(),x!==b)return n.error("Passwords don't match");if(x.length<6)return n.error("Password must be at least 6 characters");c(!0);try{await h.post("/auth/reset-password",{username:m,otp:u,password:x}),n.success("Password reset successful!"),k("/login")}catch(o){n.error(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to reset password")}finally{c(!1)}},L=async()=>{var s,t;c(!0);try{const a=await h.post("/auth/forgot-password",{username:m});n.success("New OTP sent!"),N(a.data.email),p(60),w("")}catch(a){n.error(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to send OTP")}finally{c(!1)}},F=s=>{const t=Math.floor(s/60),a=s%60;return`${t}:${a.toString().padStart(2,"0")}`};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-base-200 p-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"bg-base-100 rounded-2xl shadow-xl p-6 sm:p-8",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center",children:[r===1&&e.jsx(R,{className:"w-8 h-8 text-primary"}),r===2&&e.jsx(y,{className:"w-8 h-8 text-primary"}),r===3&&e.jsx($,{className:"w-8 h-8 text-primary"})]})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Reset Password"}),e.jsxs("p",{className:"text-sm sm:text-base text-base-content/60 mt-2",children:[r===1&&"Enter your username to receive OTP",r===2&&"Enter the OTP sent to your email",r===3&&"Create your new password"]})]}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("ul",{className:"steps steps-horizontal w-full max-w-xs",children:[e.jsx("li",{className:`step ${r>=1?"step-primary":""}`,children:"Username"}),e.jsx("li",{className:`step ${r>=2?"step-primary":""}`,children:"OTP"}),e.jsx("li",{className:`step ${r>=3?"step-primary":""}`,children:"Password"})]})}),r===1&&e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Username"})}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"your_username",value:m,onChange:s=>g(s.target.value),required:!0,autoFocus:!0})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-full",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-5 h-5 animate-spin"}),"Sending OTP..."]}):"Send OTP"})]}),r===2&&e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"alert alert-info text-sm",children:[e.jsx(y,{className:"w-5 h-5 flex-shrink-0"}),e.jsxs("span",{children:["OTP sent to ",T]})]}),e.jsxs("div",{className:`alert ${l>10?"alert-success":"alert-warning"}`,children:[e.jsx(U,{className:"w-5 h-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-semibold",children:["Time remaining: ",F(l)]}),l===0&&e.jsx("p",{className:"text-xs mt-1",children:'OTP expired! Click "Resend OTP" below.'})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Enter 6-Digit OTP"})}),e.jsx("input",{type:"text",className:"input input-bordered w-full text-center text-2xl tracking-widest font-mono",placeholder:"000000",value:u,onChange:s=>w(s.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6,required:!0,autoFocus:!0,disabled:l===0}),e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt",children:"Enter the 6-digit code from your email"})})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-full",disabled:d||u.length!==6||l===0,children:d?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-5 h-5 animate-spin"}),"Verifying..."]}):"Verify OTP"}),e.jsx("button",{type:"button",onClick:L,className:"btn btn-ghost btn-sm w-full",disabled:d||l>0,children:l>0?`Resend OTP in ${l}s`:"Resend OTP"})]}),r===3&&e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"alert alert-success text-sm",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"OTP verified! Now set your new password."})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"New Password"})}),e.jsx("input",{type:"password",className:"input input-bordered w-full",placeholder:"••••••••",value:x,onChange:s=>v(s.target.value),required:!0,autoFocus:!0}),e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt",children:"Minimum 6 characters"})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Confirm Password"})}),e.jsx("input",{type:"password",className:"input input-bordered w-full",placeholder:"••••••••",value:b,onChange:s=>P(s.target.value),required:!0})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-full",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-5 h-5 animate-spin"}),"Resetting..."]}):"Reset Password"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs(q,{to:"/login",className:"btn btn-ghost btn-sm gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Back to Login"]})})]})})})};export{V as default};
